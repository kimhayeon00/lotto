<html> 
<head>
<script src='web3.min.js'></script>
<script type="text/javascript">
var accounts;
var contractInstance;
var resultbox;
let myEtherBalance = 0;

window.addEventListener('load', async () => {
        if (window.ethereum) {
    window.alert('Modern dapp browsers')
  } else if (window.web3) {
    alert('Legacy dapp browsers')
  } else {
    alert('Non-Ethereum browser detected. You should consider trying MetaMask!');
  }

  let btn = document.getElementById("btn");
  btn.addEventListener('click', btnClicked);

  btn = document.getElementById("play");
  btn.addEventListener('click', playClicked);

  btn = document.getElementById("getwinner");
  btn.addEventListener('click', getwinnerClicked);

  btn = document.getElementById("raffle");
  btn.addEventListener('click', raffleClicked);

  btn = document.getElementById("next_week");
  btn.addEventListener('click', nextweekClicked);

  btn = document.getElementById("get_p");
  btn.addEventListener('click', getPClicked);


  resultbox = document.getElementById("resultbox");

});


async function playClicked() {
    if (contractInstance != null) {
    try { 
      let value = await contractInstance.methods.play().send({from:accounts[0]});
      resultbox.innerHTML = value;
    } catch (e) {
      resultbox.innerHTML = "Error Occured: " + e;
    }
  }
    
}


async function getwinnerClicked() {
  const value = await contractInstance.methods.winner().call();
  resultbox.innerHTML = value;
}

async function getPClicked() {
  const value = await contractInstance.methods.getParticipantsNumber().call();
  resultbox.innerHTML = value;
}
async function raffleClicked() {
    if (contractInstance != null) {
    try { 
      let value = await contractInstance.methods.raffle().send({from:accounts[0]});
      resultbox.innerHTML = value;
    } catch (e) {
      resultbox.innerHTML = "Error Occured: " + e;
    }
  }
}

async function nextweekClicked() {
    if (contractInstance != null) {
    try { 
      let value = await contractInstance.methods.GoingToNextWeekLotto().send({from:accounts[0]});
      resultbox.innerHTML = value;
    } catch (e) {
      resultbox.innerHTML = "Error Occured: " + e;
    }
  }
}

async function counterClicked() {
  const value = await contractInstance.methods.counter().call();
  resultbox.innerHTML = value;
}

async function getMsg2Clicked() {
  const value = await contractInstance.methods.getMsg2().call();
  resultbox.innerHTML = value;
}

async function msg1Clicked() {
  const value = await contractInstance.methods.msg1().call();
  resultbox.innerHTML = value;

}

async function ownerClicked() {
  const value = await contractInstance.methods.owner().call();
  resultbox.innerHTML = value;
}

async function btnClicked() {
  accounts = await ethereum.request({ method: 'eth_requestAccounts' });
  const showAccount = document.querySelector('.showAccount');
  showAccount.innerHTML = accounts[0];
  var abiobj = [
	{
		"inputs": [],
		"name": "GoingToNextWeekLotto",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "play",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "raffle",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "payable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "getParticipantsNumber",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getRaffleEtherBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "myEtherBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "participants",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "week_ended",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "week_status",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winner",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
  var address = "0xd8b934580fcE35a11B58C6D73aDeE468a2833fa8";
  window.web3 = new Web3(window.ethereum);
  contractInstance = await new window.web3.eth.Contract(abiobj, address);
  

}
</script></head>
<body>
<h1> lotto </h1>
<br/>
<input type="image" id="btn" src="./img/MetaMask_Fox.svg.png" height="80" width="80" value="Connect to MetaMask">
<h2>참가비용 : 1 either</h2>
<h2>Account: <span class="showAccount"></span></h2>
<!-- <h2>My balance: </h2> -->

<input type="button" id="play" value="play">
<br/>
<input type="button" id="getwinner" value="당첨자">
<br/>
<input type="button" id="raffle" value="추첨">
<br/>
<input type="button" id="next_week" value="한번더">
<br/>
<input type="button" id="get_p" value="참여자 수">
<br/>
Result: <span id="resultbox"> </span>
</body> </html>

